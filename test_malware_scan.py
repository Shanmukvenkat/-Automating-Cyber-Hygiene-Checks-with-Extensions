import os
import logging
from malware_scan import malware_scan  # Import the function from your main file

# Configure logging for the test
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')

def create_test_files(base_path):
    """
    Creates test files to validate malware scan functionality.
    """
    os.makedirs(base_path, exist_ok=True)

    # Create some test files
    with open(os.path.join(base_path, "malware_test.txt"), "w") as f:
        f.write("This file is flagged as malware.")

    with open(os.path.join(base_path, "suspicious_file.doc"), "w") as f:
        f.write("This file is flagged as suspicious.")

    with open(os.path.join(base_path, "normal_file.txt"), "w") as f:
        f.write("This is a normal file.")

    with open(os.path.join(base_path, "executable.exe"), "w") as f:
        f.write("This is an executable file.")

def test_malware_scan():
    """
    Tests the malware_scan function.
    """
    # Define the test directory
    test_dir = "test_directory"

    # Create test files
    create_test_files(test_dir)

    # Run the malware scan
    result = malware_scan(test_dir)

    # Print the results
    print("Malicious files detected:")
    for file in result['malicious']:
        print(f" - {file}")

    print("\nSuspicious files detected:")
    for file in result['suspicious']:
        print(f" - {file}")

    # Cleanup
    import shutil
    shutil.rmtree(test_dir)

if __name__ == "__main__":
    test_malware_scan()
